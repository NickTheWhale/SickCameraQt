\doxysection{Visionary\+Data.\+h}
\hypertarget{_visionary_data_8h_source}{}\label{_visionary_data_8h_source}\index{sickapi/src/VisionaryData.h@{sickapi/src/VisionaryData.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ SPDX-\/License-\/Identifier:\ Unlicense}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ }}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ Created:\ August\ 2017}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ }}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ SICK\ AG,\ Waldkirch}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ email:\ TechSupport0905@sick.de}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <cstdint>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}PointXYZ.h"{}}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacevisionary}{visionary}}}
\DoxyCodeLine{00018\ \{}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \ \ \ \ \textcolor{comment}{//\ Parameters\ to\ be\ extracted\ from\ the\ XML\ metadata\ part}}
\DoxyCodeLine{00021\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structvisionary_1_1_camera_parameters}{CameraParameters}}\ \{}
\DoxyCodeLine{00023\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structvisionary_1_1_camera_parameters_ab169cf570583dd59545a02d0409d9d66}{height}};}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structvisionary_1_1_camera_parameters_a7b2839790bd58b6ac797b018175bfba7}{width}};}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{structvisionary_1_1_camera_parameters_a91c5e3ba125c0f17846039df412c002a}{cam2worldMatrix}}[4\ *\ 4];}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{structvisionary_1_1_camera_parameters_adc28f3af0f90c44b3786cf812b0168a2}{fx}},\ fy,\ cx,\ cy;}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{structvisionary_1_1_camera_parameters_a62316e149dfbc91e7d54ad8a79f86c6b}{k1}},\ k2,\ p1,\ p2,\ k3;}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{structvisionary_1_1_camera_parameters_a82c778caaf29fc4a560a50126f01b540}{f2rc}};}
\DoxyCodeLine{00034\ \ \ \ \ \};}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structvisionary_1_1_data_sets_active}{DataSetsActive}}\ \{}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ hasDataSetDepthMap;}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ hasDataSetPolar2D;}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ hasDataSetCartesian;}
\DoxyCodeLine{00040\ \ \ \ \ \};}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structvisionary_1_1_point_x_y_z_c}{PointXYZC}}\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ x;}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ y;}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ z;}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ c;}
\DoxyCodeLine{00047\ \ \ \ \ \};}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classvisionary_1_1_visionary_data}{VisionaryData}}}
\DoxyCodeLine{00050\ \ \ \ \ \{}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classvisionary_1_1_visionary_data}{VisionaryData}}();}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classvisionary_1_1_visionary_data}{\string~VisionaryData}}();}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Getter\ Functions}}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ and\ return\ the\ Point\ Cloud\ in\ the\ camera\ perspective.\ Units\ are\ in\ meters.}}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ generatePointCloud(std::vector<PointXYZ>\&\ pointCloud)\ =\ 0;}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Transform\ the\ XYZ\ point\ cloud\ with\ the\ Cam2World\ matrix\ got\ from\ device}}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ IN/OUT\ pointCloud\ \ -\/\ Reference\ to\ the\ point\ cloud\ to\ be\ transformed.\ Contains\ the\ transformed\ point\ cloud\ afterwards.}}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ transformPointCloud(std::vector<PointXYZ>\&\ pointCloud)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ getHeight()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ getWidth()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Returns\ the\ Byte\ length\ compared\ to\ data\ types}}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ uint32\_t\ getFrameNum()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Returns\ the\ timestamp\ in\ device\ format}}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Bits\ of\ the\ devices\ timestamp:\ 5\ unused\ -\/\ 12\ Year\ -\/\ 4\ Month\ -\/\ 5\ Day\ -\/\ 11\ Timezone\ -\/\ 5\ Hour\ -\/\ 6\ Minute\ -\/\ 6\ Seconds\ -\/\ 10\ Milliseconds}}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ .....YYYYYYYYYYYYMMMMDDDDDTTTTTTTTTTTHHHHHMMMMMMSSSSSSmmmmmmmmmm}}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ uint64\_t\ getTimestamp()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Returns\ the\ timestamp\ in\ milliseconds}}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ uint64\_t\ getTimestampMS()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Returns\ a\ reference\ to\ the\ camera\ parameter\ struct}}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structvisionary_1_1_camera_parameters}{CameraParameters}}\&\ getCameraParameters()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ functions\ for\ parsing\ received\ blob}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Parse\ the\ XML\ Metadata\ part\ to\ get\ information\ about\ the\ sensor\ and\ the\ following\ image\ data.}}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Returns\ true\ when\ parsing\ was\ successful.}}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ parseXML(\textcolor{keyword}{const}\ std::string\&\ xmlString,\ uint32\_t\ changeCounter)\ =\ 0;}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Parse\ the\ Binary\ data\ part\ to\ extract\ the\ image\ data.\ }}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Returns\ true\ when\ parsing\ was\ successful.}}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ parseBinaryData(std::vector<uint8\_t>::iterator\ inputBuffer,\ \textcolor{keywordtype}{size\_t}\ length)\ =\ 0;}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Device\ specific\ image\ types}}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \textcolor{keyword}{enum}\ ImageType\ \{\ UNKNOWN,\ PLANAR,\ RADIAL\ \};}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Returns\ the\ Byte\ length\ compared\ to\ data\ type\ given\ as\ String}}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ getItemLength(std::string\ dataType);}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Pre-\/calculate\ lookup\ table\ for\ lens\ distortion\ correction,\ }}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ which\ is\ needed\ for\ point\ cloud\ calculation.}}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ preCalcCamInfo(\textcolor{keyword}{const}\ ImageType\&\ type);}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ and\ return\ the\ Point\ Cloud\ in\ the\ camera\ perspective.\ Units\ are\ in\ meters.}}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ IN\ \ map\ \ \ \ \ \ \ \ \ -\/\ Image\ to\ be\ transformed}}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ IN\ \ imgType\ \ \ \ \ -\/\ Type\ of\ the\ image\ (needed\ for\ correct\ transformation)}}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ OUT\ pointCloud\ \ -\/\ Reference\ to\ pass\ back\ the\ point\ cloud.\ Will\ be\ resized\ and\ only\ contain\ new\ point\ cloud.}}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ generatePointCloud(\textcolor{keyword}{const}\ std::vector<uint16\_t>\&\ map,\ \textcolor{keyword}{const}\ ImageType\&\ imgType,\ std::vector<PointXYZ>\&\ pointCloud);}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Camera\ parameters\ to\ be\ read\ from\ XML\ Metadata\ part}}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structvisionary_1_1_camera_parameters}{CameraParameters}}\ m\_cameraParams\{\};}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{classvisionary_1_1_visionary_data_ab1bc40424a7ce980ff27d5c0e7300e45}{m\_scaleZ}};}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ uint\_fast32\_t\ \mbox{\hyperlink{classvisionary_1_1_visionary_data_aabd2504ea82e6c87c1e383f0683af048}{m\_changeCounter}};}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Framenumber\ of\ the\ frame}}
\DoxyCodeLine{00120\ \textcolor{comment}{}\ \ \ \ \ \ \ \ uint\_fast32\_t\ \mbox{\hyperlink{classvisionary_1_1_visionary_data_a4debd809bb153bffdc0c928680d39475}{m\_frameNum}};}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Timestamp\ in\ blob\ format}}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ To\ get\ timestamp\ in\ milliseconds\ call\ getTimestampMS()}}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ uint64\_t\ m\_blobTimestamp;}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Camera\ undistort\ pre-\/calculations\ (look-\/up-\/tables)\ are\ generated\ to\ speed\ up\ computations.\ True\ if\ this\ has\ been\ done.}}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ ImageType\ m\_preCalcCamInfoType;}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ look-\/up-\/tables\ containing\ pre-\/calculations}}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ std::vector<PointXYZ>\ m\_preCalcCamInfo;}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Bitmasks\ to\ calculate\ the\ timestamp\ in\ milliseconds}}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Bits\ of\ the\ devices\ timestamp:\ 5\ unused\ -\/\ 12\ Year\ -\/\ 4\ Month\ -\/\ 5\ Day\ -\/\ 11\ Timezone\ -\/\ 5\ Hour\ -\/\ 6\ Minute\ -\/\ 6\ Seconds\ -\/\ 10\ Milliseconds}}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ .....YYYYYYYYYYYYMMMMDDDDDTTTTTTTTTTTHHHHHMMMMMMSSSSSSmmmmmmmmmm}}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ uint64\_t\ BITMASK\_YEAR\ =\ 0x7FF800000000000;\ \textcolor{comment}{//\ 0000011111111111100000000000000000000000000000000000000000000000}}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ uint64\_t\ BITMASK\_MONTH\ =\ 0x780000000000;\ \ \ \textcolor{comment}{//\ 0000000000000000011110000000000000000000000000000000000000000000}}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ uint64\_t\ BITMASK\_DAY\ =\ 0x7C000000000;\ \ \ \ \ \ \textcolor{comment}{//\ 0000000000000000000001111100000000000000000000000000000000000000}}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ uint64\_t\ BITMASK\_HOUR\ =\ 0x7C00000;\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 0000000000000000000000000000000000000111110000000000000000000000}}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ uint64\_t\ BITMASK\_MINUTE\ =\ 0x3F0000;\ \ \ \ \ \ \ \ \textcolor{comment}{//\ 0000000000000000000000000000000000000000001111110000000000000000}}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ uint64\_t\ BITMASK\_SECOND\ =\ 0xFC00;\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 0000000000000000000000000000000000000000000000001111110000000000}}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ uint64\_t\ BITMASK\_MILLISECOND\ =\ 0x3FF;\ \ \ \ \ \ \textcolor{comment}{//\ 0000000000000000000000000000000000000000000000000000001111111111}}
\DoxyCodeLine{00142\ \ \ \ \ \};}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00144\ \}}

\end{DoxyCode}
